#-------------------------------------------------------------------------------
#
# GitHub Actions Test Workflow
#
# Validate that code changes do not contain any linting issues and that they
# pass all automated tests.
#
#-------------------------------------------------------------------------------
---
name: "Test"

on:
    schedule:
        # 11pm UTC (9am Brisbane)
        - cron: "0 23 * * *"
    pull_request: {}
    push:
        branches:
            - "master"

env:
    CI: true

jobs:
    test:
        runs-on: "ubuntu-latest"

        steps:
            - uses: "actions/checkout@v1"

            - name: "Use Node.js 12.x"
              uses: "actions/setup-node@v1"
              with:
                  node-version: "12.x"

            - name: "Set up Go 1.14"
              uses: "actions/setup-go@v1"
              with:
                  go-version: 1.14
              id: "go"

            - name: "Install Dependencies"
              run: "go mod vendor && yarn install --no-audit"

            - name: "Verify"
              run: "yarn lint && yarn test && gofmt -l ./server/ && go test ./server/..."
